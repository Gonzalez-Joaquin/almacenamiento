<!DOCTYPE html>
<html lang="es-Es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/materials.css">
    <title>Materiales</title>
</head>

<body class="body flex">
    <div class="header flex">
        <button class="btn subroute flex">Agregar materiales</button>
        <button class="btn subroute flex">Listado de materiales</button>
    </div>
    <section class="section">
        <article class="article active flex">
            <form class="form addMaterial flex" id="addMaterialForm">
                <div class="flex">
                    <h3>Agregar Material</h3>
                </div>
                <div class="flex">
                    <label for="newMaterialName">Nombre</label>
                    <input name="newMaterialName" id="newMaterialName" type="text">
                </div>
                <div class="flex">
                    <label for="newMaterialCategory">Proyecto</label>
                    <div class="select">
                        <button type="button" name="newMaterialCategory" id="newMaterialCategory"
                            onclick="toggleSelect()">
                            <span>Seleccione categor√≠a</span>
                            <i class="fi fi-br-angle-right"></i>
                        </button>
                        <div class="options flex" id="categoryBody"></div>
                    </div>
                </div>
                <script>
                    const getDataCategory = async () => {
                        const options = { method: 'GET' };
                        try {
                            const response = await fetch(`http://localhost:5000/category`, options);
                            const data = await response.json();
                            return data;
                        } catch (err) {
                            throw new Error(err);
                        }
                    }

                    const populateCategoryOptions = async () => {
                        const categoryBody = document.getElementById('categoryBody');
                        try {
                            const data = await getDataCategory();
                            categoryBody.innerHTML = data.map(item => {
                                return (`
                                <div onclick="handleClick('${item.name}')">
                                    <span>${item.name}</span>
                                </div>
                                `)
                            }).join('');
                        } catch (error) {
                            console.error('Error fetching category data:', error.message);
                        }
                    }

                    populateCategoryOptions()

                    const toggleSelect = () => {
                        document.getElementById('categoryBody').classList.toggle('active')
                    }

                    const handleClick = param => {
                        document.querySelector('#newMaterialCategory span').innerHTML = param
                        document.getElementById('categoryBody').classList.remove('active')
                    }
                </script>
                <div class="flex">
                    <label for="newMaterialStock">Stock</label>
                    <input name="newMaterialStock" id="newMaterialStock" type="number">
                </div>
                <div class="flex">
                    <label for="newMaterialLimit">Limite por estudiante</label>
                    <input type="number" id="newMaterialLimit" name="newMaterialLimit">
                </div>
                <button type="submit" class="btn">
                    Agregar
                </button>
            </form>
        </article>
        <article class="article list flex">
            <table class="table">
                <thead>
                    <tr>
                        <th><span>Nombre</span></th>
                        <th><span>Stock</span></th>
                        <th><span>Proyecto</span></th>
                        <th><span>Limite por estudiante</span></th>
                        <th class="th-buttons"><span></span></th>
                    </tr>
                </thead>
                <tbody id="tboodyMaterials"></tbody>
            </table>
        </article>
    </section>
    <div id="editEntry" class="popUp flex">
        <form class="flex" id="editEntryForm">
            <div class="flex" style="justify-content: space-between; width: 100%;">
                <h3>Editar Material</h3>
                <button type="reset" class="crossBtn" onclick="closeEdit()">
                    <i class="fi fi-br-cross"></i>
                </button>
            </div>
            <div class="container flex" id="containerEditEntry"></div>
        </form>
    </div>
    <script src="../js/materials.js"></script>
</body>

</html>